{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Dashboard</title>
  <!-- Favicon -->
  <link rel="shortcut icon" href="./img/svg/logo.svg" type="image/x-icon">
  <!-- Custom styles -->
  <link rel="stylesheet" href="{% static './css/style.min2.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <title>Your Page Title</title>
    <style>
        .user-table {
            border-collapse: collapse;
            width: 100%;
            border: 2px solid #2f49d1; /* blue border color */
        }

        .user-table th, .user-table td {
            border: 1px solid #2f49d1; /* blue border color */
            padding: 8px;
            text-align: left;
        }

        .blue-header {
            background-color: #2f49d1; /* blue background color */
            color: #fff; /* White text color */
        }
    </style>
</head>

<body>
  
  <div class="layer"></div>
<!-- ! Body -->
<a class="skip-link sr-only" href="#skip-target">Skip to content</a>
<div class="page-flex">
  <!-- ! Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-start">
        <div class="sidebar-head">
            <a href="/" class="logo-wrapper" title="Home">
                <span class="sr-only">Home</span>
                <span class="icon logo" aria-hidden="true"></span>
                <div class="logo-text">
                    <span class="logo-title">Admin</span>
                    <span class="logo-subtitle">Dashboard</span>
                </div>

            </a>
            <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
                <span class="sr-only">Toggle menu</span>
                <span class="icon menu-toggle" aria-hidden="true"></span>
            </button>
        </div>
        <div class="sidebar-body">
            <ul class="sidebar-body-menu">
                <li>
                    <a class="active" href="/"><span class="icon home" aria-hidden="true"></span>Dashboard</a>
                </li>
                <li>
                  <a class="show-cat-btn" href="##">
                      <span class="icon user-3" aria-hidden="true"></span>Users
                      <span class="category__btn transparent-btn" title="Open list">
                          <span class="sr-only">Open list</span>
                          <span class="icon arrow-down" aria-hidden="true"></span>
                      </span>
                  </a>
                </li>
                <li>
                    <a class="show-cat-btn" href="##">
                        <span class="icon document" aria-hidden="true"></span>Track Progress
                        <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                    </a>
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'posts.html' %}">All Posts</a>
                        </li>
                        <li>
                            <a href="{% static 'new-post.html' %}">Add new post</a>
                        </li>
                    </ul> {% endcomment %}
                </li>
               
                <li>
                    <a class="show-cat-btn" href="##">
                        <span class="icon folder" aria-hidden="true"></span>Categories
                        <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                    </a>
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'categories.html' %}">All categories</a>
                        </li>
                    </ul> {% endcomment %}
                </li>
                <li>
                    <a class="show-cat-btn" href="##">
                        <span class="icon image" aria-hidden="true"></span>Recipe Catalog
                        <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                    </a>
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'media-01.html' %}">Media-01</a>
                        </li>
                        <li>
                            <a href="{% static 'media-02.html' %}">Media-02</a>
                        </li>
                    </ul> {% endcomment %}
                </li>
                <li>
                    <a class="show-cat-btn" href="##">
                        <span class="icon paper" aria-hidden="true"></span>Diet Chart
                        <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                    </a>
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'pages.html' %}">All pages</a>
                        </li>
                        <li>
                            <a href="{% static 'new-page.html' %}">Add new page</a>
                        </li>
                    </ul> {% endcomment %}
                </li>
                <li>
                    <a href="{% static 'comments.html' %}">
                        <span class="icon message" aria-hidden="true"></span>
                        Comments
                    </a>
                    <span class="msg-counter">7</span>
                </li>
            </ul>
            <span class="system-menu__title">system</span>
            <ul class="sidebar-body-menu">
                <li>
                    <a href="appearance.html"><span class="icon edit" aria-hidden="true"></span>Appearance</a>
                </li>
                <li>
                    <a class="show-cat-btn" href="##">
                        <span class="icon category" aria-hidden="true"></span>Extentions
                        <span class="category__btn transparent-btn" title="Open list">
                            <span class="sr-only">Open list</span>
                            <span class="icon arrow-down" aria-hidden="true"></span>
                        </span>
                    </a>
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'extention-01.html' %}">Extentions-01</a>
                        </li>
                        <li>
                            <a href="{% static 'extention-02.html' %}">Extentions-02</a>
                        </li>
                    </ul> {% endcomment %}
                </li>
               
                    {% comment %} <ul class="cat-sub-menu">
                        <li>
                            <a href="{% static 'users-01.html' %}">Users-01</a>
                        </li>
                        <li>
                            <a href="{% static 'users-02.html' %}">Users-02</a>
                        </li>
                    </ul> {% endcomment %}
                  {% comment %} </li> {% endcomment %}
                <li>
                    <a href="##"><span class="icon setting" aria-hidden="true"></span>Settings</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="sidebar-footer">
        <a href="##" class="sidebar-user">
            <span class="sidebar-user-img">
                <picture><source srcset="{% static './img/avatar/avatar-illustrated-01.webp' %}" type="image/webp"><img src="{% static './img/avatar/avatar-illustrated-01.png' %}" alt="User name"></picture>
            </span>
            <div class="sidebar-user-info">
                <span class="sidebar-user__title">Admin</span>
                <span class="sidebar-user__subtitle">Admin Dasboard</span>
            </div>
        </a>
    </div>
</aside>
  <div class="main-wrapper">
    <!-- ! Main nav -->
    <nav class="main-nav--bg">
  <div class="container main-nav">
    <div class="main-nav-start">
      <div class="search-wrapper">
        <i data-feather="search" aria-hidden="true"></i>
        <input type="text" placeholder="Enter keywords ..." required>
      </div>
    </div>
    <div class="main-nav-end">
      <button class="sidebar-toggle transparent-btn" title="Menu" type="button">
        <span class="sr-only">Toggle menu</span>
        <span class="icon menu-toggle--gray" aria-hidden="true"></span>
      </button>
      {% comment %} <div class="lang-switcher-wrapper">
        <button class="lang-switcher transparent-btn" type="button">
          EN
          <i data-feather="chevron-down" aria-hidden="true"></i>
        </button>
        <ul class="lang-menu dropdown">
          <li><a href="##">English</a></li>
          <li><a href="##">French</a></li>
          <li><a href="##">Uzbek</a></li>
        </ul>
      </div> {% endcomment %}
      {% comment %} <button class="theme-switcher gray-circle-btn" type="button" title="Switch theme">
        <span class="sr-only">Switch theme</span>
        <i class="sun-icon" data-feather="sun" aria-hidden="true"></i>
        <i class="moon-icon" data-feather="moon" aria-hidden="true"></i>
      </button> {% endcomment %}
      <div class="notification-wrapper">
        {% comment %} <button class="gray-circle-btn dropdown-btn" title="To messages" type="button">
          <span class="sr-only">To messages</span>
          <span class="icon notification active" aria-hidden="true"></span>
        </button> {% endcomment %}
        <ul class="users-item-dropdown notification-dropdown dropdown">
          <li>
            <a href="##">
              <div class="notification-dropdown-icon info">
                <i data-feather="check"></i>
              </div>
              <div class="notification-dropdown-text">
                <span class="notification-dropdown__title">System just updated</span>
                <span class="notification-dropdown__subtitle">The system has been successfully upgraded. Read more
                  here.</span>
              </div>
            </a>
          </li>
          <li>
            <a href="##">
              <div class="notification-dropdown-icon danger">
                <i data-feather="info" aria-hidden="true"></i>
              </div>
              <div class="notification-dropdown-text">
                <span class="notification-dropdown__title">The cache is full!</span>
                <span class="notification-dropdown__subtitle">Unnecessary caches take up a lot of memory space and
                  interfere ...</span>
              </div>
            </a>
          </li>
          <li>
            <a href="##">
              <div class="notification-dropdown-icon info">
                <i data-feather="check" aria-hidden="true"></i>
              </div>
              <div class="notification-dropdown-text">
                <span class="notification-dropdown__title">New Subscriber here!</span>
                <span class="notification-dropdown__subtitle">A new subscriber has subscribed.</span>
              </div>
            </a>
          </li>
          <li>
            <a class="link-to-page" href="##">Go to Notifications page</a>
          </li>
        </ul>
      </div>
      <div class="nav-user-wrapper">
        <button href="##" class="nav-user-btn dropdown-btn" title="My profile" type="button">
          <span class="sr-only">My profile</span>
          <span class="nav-user-img">
            <picture><source srcset="{% static './img/avatar/avatar-illustrated-02.webp' %}" type="image/webp"><img src="{% static './img/avatar/avatar-illustrated-02.png' %}" alt="User name"></picture>
          </span>
        </button>
        <ul class="users-item-dropdown nav-user-dropdown dropdown">
          <li><a href="##">
              <i data-feather="user" aria-hidden="true"></i>
              <span>Profile</span>
            </a></li>
          <li><a href="##">
              <i data-feather="settings" aria-hidden="true"></i>
              <span>Account settings</span>
            </a></li>
          <li><a class="danger" id="logout-link" href="{% url 'loggout' %}">
            <i data-feather="log-out" aria-hidden="true"></i>
            <span>Log out</span></a></li>
        </ul>
        
      </div>
    </div>
  </div>
</nav>
<h3>Registered Users</h3><br>
<table class="user-table">
  <thead>

      <tr>
        <th class="blue-header">Username</th>
        <th class="blue-header">Email</th>
        <th class="blue-header">User</th>
        {% comment %} <th class="blue-header">Action</th> {% endcomment %}
        <th class="blue-header">Status</th>
          
      </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <td>{{ user.username }}</td>
      <td>{{ user.email }}</td>
      <td>
        {% if user.is_Customer %}
          Customer
        {% elif user.is_Dietitian %}
          Dietitian
        {% elif user.is_Doctor %}
          Doctor
        {% endif %}
      </td>
      {% comment %} <td>
        <form method="POST" action="{% url 'delete_user' user.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
      </td> {% endcomment %}
      <td>
        {% if user.is_active %}
<!-- Example button for toggling user status -->
        <button class="toggle-status" data-user-id="{{ user.id }}" data-status="{{ user.is_active }}">Active</button>
        {% else %}
          <button class="toggle-status" data-user-id="{{ user.id }}" data-status="inactive">Inactive</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
  
</table>

<script>document.addEventListener('DOMContentLoaded', function() {
  const toggleButtons = document.querySelectorAll('.toggle-status');

  toggleButtons.forEach(button => {
      button.addEventListener('click', function() {
          const userId = this.getAttribute('data-user-id');
          const currentStatus = this.getAttribute('data-status');

          // Send a POST request to toggle the user's status
          fetch(`/toggle_user_status/${userId}/`, {
              method: 'POST',
              headers: {
                  'X-CSRFToken': getCookie('csrftoken'),  // Make sure to include the CSRF token
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({ user_id: userId, status: currentStatus }),
          })
          .then(response => {
              if (response.ok) {
                  // Reload the page or update the UI as needed
                  window.location.reload();  // Refresh the page in this example
              } else {
                  console.error('Failed to toggle user status');
              }
          })
          .catch(error => {
              console.error('Error:', error);
          });
      });
  });
});
button.addEventListener('click', function() {
  alert('Button Clicked'); // Add this line
  // Rest of your code
});

// Function to get the CSRF token (you can place this in your script)
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}
</script>
    
<script src="{% static './plugins/chart.min.js' %}"></script>
<!-- Icons library -->
<script src="{% static 'plugins/feather.min.js' %}"></script>
<!-- Custom scripts -->
<script src="{% static 'js/script.js' %}"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</body>
{% comment %} <script>
  // Wait for the document to be fully loaded
  document.addEventListener("DOMContentLoaded", function () {
      // Find the logout button by its ID
      var logoutButton = document.getElementById("logout-link");
  
      // Add a click event listener to the logout button
      logoutButton.addEventListener("click", function (event) {
          // Prevent the default action of the link (i.e., navigating to /loggout)
          event.preventDefault();
  
          // Reload the page after a short delay (you can adjust the delay as needed)
          setTimeout(function () {
              location.reload();
          }, 1000); // Reload after 1 second (1000 milliseconds)
      });
  });
  </script> {% endcomment %}
{% comment %} <script>
  // Wait for the document to be fully loaded
  document.addEventListener("DOMContentLoaded", function () {
      // Find the logout button by its ID
      var logoutButton = document.getElementById("logout-link");

      // Add a click event listener to the logout button
      logoutButton.addEventListener("click", function () {
          // Reload the page after a short delay (you can adjust the delay as needed)
          setTimeout(function () {
              location.reload();
          }, 1000); // Reload after 1 second (1000 milliseconds)
      });
  });
</script> {% endcomment %}

</html>